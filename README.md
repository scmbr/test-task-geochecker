# Система геооповещений
Ядро системы геооповещений: принимает координаты от мобильного приложения, возвращает ближайшие опасные зоны и асинхронно уведомляет новостной портал через вебхуки.
## Описание
Сервис реализован на Go (Go 1.24+), построен по Clean Architecture (Handler → Service → Repository).
Сервис:
- принимает координаты пользователя
- возвращает ближайшие активные инциденты
- сохраняет факт проверки
- асинхронно отправляет вебхук на Django-портал
- поддерживает CRUD для инцидентов (оператор + API-key)
- имеет статистику и health-check
- использует PostgreSQL и Redis (кэш + очередь)
## Архитектура 
Проект построен по принципам Clean Architecture.
Ядром системы являются Domain (сущности) и Use Cases (бизнес-логика). 
Внешние адаптеры (HTTP, PostgreSQL, Redis, Webhook) реализуют интерфейсы, определённые в ядре, и зависят от него. 
Зависимости направлены внутрь: внутренние слои не знают о внешних.
## Функциональность
### 1. CRUD инцидентов и статистика (оператор)
- POST /api/v1/incidents — создать инцидент
- GET /api/v1/incidents — список (пагинация) + кэширование
- GET /api/v1/incidents/{id} — получить по id
- PUT /api/v1/incidents/{id} — обновить
- DELETE /api/v1/incidents/{id} — деактивация (soft delete)

- GET /api/v1/incidents/stats/{id} - получение статистики
Авторизация: API-key (роль оператор).

### 2. Проверка координат (публичный endpoint)
- POST /api/v1/location/check \
Возвращает список ближайших опасных зон + сохраняет запись в бд, ставит задачу в очередь на отправку вебхука.
### 3. Создание и удаление операторов
- POST /api/v1/operators — создать оператора
- DELETE /api/v1/operators/{id} — удалить (soft delete)
Авторизация: API-key (роль оператор).
### 4. Мониторинг
- GET /api/v1/system/health — получение состояния API
## Технологии
- Go 1.24+
- PostgreSQL 15 + PostGIS
- Redis (кэш + очередь)
- Docker + docker-compose
- SQL-миграции
## Надежность и безопасность
- Валидируется вход (координаты, параметры)
- Защита от SQL-инъекций через prepared statements / ORM
- Кэширование активных инцидентов в Redis
- Retry для вебхуков
- Soft delete для инцидентов
## Запуск проекта
### Команда
Запуск осуществляется одной командой
```
docker-compose -p scmbr-geochecker up
```
### Миграции
Миграции включены в проект docker-compose, отдельно запускать не нужно
### Переменные окружения
Необязательны, есть дефолтные значения. Но, если хочется, можно поставить свои
```
# PostgreSQL
POSTGRES_USER=vasya
POSTGRES_PASSWORD=geochecker
POSTGRES_DB=geochecker
# Redis
REDIS_PASSWORD=geochecker
# Security
API_KEY_SECRET=geochecker
# Webhook
WEBHOOK_URL=
```
### Начальные данные (seed)
При первом запуске приложения в базу автоматически добавляются 3 тестовых оператора.
Это нужно, чтобы сразу можно было тестировать API (например, создавать инциденты).
- "Vasya", "secret1"
- "Sasha", "secret2"
- "Tanya", "secret3"


